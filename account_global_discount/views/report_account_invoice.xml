<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2022 Simone Rubino - TAKOBI
     Copyright 2024 Sergio Zanchetta - PNLUG APS
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <template id="report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//div[@id='total']/div/table/tr[1]" position="before">
            <t t-if="o.global_discount_ids and o.global_discount_base == 'subtotal'">
                <tr>
                    <td>
                        <strong>Subtotal w/o disc.</strong>
                    </td>
                    <td class="text-right">
                        <span
                            t-field="o.amount_untaxed_before_global_discounts"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                        />
                    </td>
                </tr>
                <tr style="border-bottom:1px solid #dddddd;">
                    <td>
                        <strong>Global Discounts</strong>
                        <br />
                        <t
                            t-esc="'→'.join(['{:.2f}%'.format(x.discount) for x in o.global_discount_ids])"
                        />
                    </td>
                    <td class="text-right">
                        <span
                            t-field="o.amount_global_discount"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                        />
                    </td>
                </tr>
            </t>
        </xpath>
        <xpath
            expr="//div[@id='total']/div/table/tr[hasclass('o_total')]"
            position="before"
        >
            <t t-if="o.global_discount_ids and o.global_discount_base == 'total'">
                <tr class="border-black">
                    <td><strong>Total before disc.</strong></td>
                    <td class="text-right">
                        <span
                            t-field="o.amount_total_before_global_discounts"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                        />
                    </td>
                </tr>
                <tr>
                    <td><strong>Global Discounts</strong><br />
                        <t t-foreach="o.global_discount_ids" t-as="global_discount_id">
                            <t t-if="global_discount_id.discount_type == 'percentage'">
                                <t
                                    t-esc="'→'.join(['{:.2f}%'.format(global_discount_id.discount)])"
                                />
                            </t>
                            <t t-else="global_discount_id.discount_type == 'fixed'">
                                <t
                                    t-esc="'→'.join(['{:.2f}'.format(global_discount_id.discount_fixed)])"
                                />
                            </t>
                        </t>
                    </td>
                    <td class="text-right">
                        <span
                            t-field="o.amount_global_discount"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                        />
                    </td>
                </tr>
            </t>
        </xpath>
    </template>
</odoo>
