<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2015 Akretion (http://www.akretion.com/)
    @author: Alexis de Lattre <alexis.delattre@akretion.com>
    The licence is in the file __openerp__.py
-->

<openerp>
<data>

<record id="account_invoice_pdf_import_form" model="ir.ui.view">
    <field name="name">account.invoice.pdf.import.form</field>
    <field name="model">account.invoice.pdf.import</field>
    <field name="arch"  type="xml">
        <form string="Import Supplier Invoice or Refund as PDF">
            <group name="technical" invisible="1">
                <field name="state"/>
                <field name="currency_id"/>
            </group>
            <group name="help-import" states="import">
              <div>
                <p>Upload below the supplier invoice or refund as PDF file. When you click on the Import button:</p>
                <ol>
                  <li>Odoo will try to extract an XML file embedded inside the PDF file. It will work only if the invoice complies with the <a href="//www.pdflib.com/knowledge-base/pdfa/zugferd-invoices/" target="_blank">ZUGFeRD</a> standard (an implementation of the <a href="http://tfig.unece.org/contents/cross-industry-invoice-cii.htm" target="_blank">Core Industry Invoice</a> specifications).</li>
                  <li>Otherwise, Odoo will use the <a href="https://github.com/akretion/invoice2data/" target="_blank">invoice2data</a> library to read the text of the PDF and get the information. It will work only if the invoice2data library has a template for the invoices of that supplier.</li>
                  <li>Odoo will use this information to create a draft supplier invoice. If there is already a draft invoice for that supplier in Odoo, you will have the option to update that invoice.</li>
                </ol>
              </div>
            </group>
            <group name="help-update" states="update">
                <div>
                    <p>Some draft supplier invoices/refunds have been found for the supplier of the PDF invoice you are importing ; one of them may correspond to the PDF invoice. You can either select an existing draft supplier invoice to update with the information of the PDF (information that will be updated include invoice date, supplier invoice number and attachment) or create a new draft invoice.</p>
                </div>
            </group>
            <group name="import" states="import">
                <field name="pdf_file" filename="pdf_filename"/>
                <field name="pdf_filename" invisible="1"/>
            </group>
            <group name="update" states="update">
                <field name="partner_id"/>
                <field name="invoice_type"/>
                <field name="amount_untaxed"
                    widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="amount_total"
                    widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="invoice_id"
                    domain="[('state', '=', 'draft'), ('type', 'in', ('in_invoice', 'in_refund')), ('commercial_partner_id', '=', partner_id), ('type', '=', invoice_type)]"/>
            </group>
            <footer>
                <button name="import_invoice" type="object"
                    class="oe_highlight" string="Import" states="import"/>
                <button name="update_invoice" type="object"
                    class="oe_highlight" string="Update Existing" states="update"/>
                <button name="create_invoice" type="object"
                    class="oe_highlight" string="Create New" states="update"/>
                <button special="cancel" string="Cancel" class="oe_link"/>
            </footer>
        </form>
    </field>
</record>

<record id="account_invoice_pdf_import_action" model="ir.actions.act_window">
    <field name="name">Import PDF Invoice</field>
    <field name="res_model">account.invoice.pdf.import</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
</record>

<menuitem id="account_invoice_pdf_import_menu"
    parent="account.menu_finance_payables"
    action="account_invoice_pdf_import_action" sequence="15"/>

</data>
</openerp>
